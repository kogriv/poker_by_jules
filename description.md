# Texas Hold'em Poker Game - MVP Phase 1

## Описание проекта

Этот проект представляет собой консольную реализацию игры в Техасский Холдем, разработанную с акцентом на расширяемую архитектуру. На данном этапе (MVP Фаза 1) реализована базовая игровая логика для одного человека против 2-3 простых ботов. Ключевой особенностью является применение паттернов проектирования, таких как Repository, Strategy, Observer, State Machine и Factory, для обеспечения гибкости и упрощения будущих доработок, включая добавление новых интерфейсов (например, Telegram-бот) и хранилищ данных.

## MVP Фаза 1: Функционал

*   **Игровой процесс:** Техасский Холдем.
*   **Игроки:** 1 человек + 2-3 бота (RandomBot, TightBot).
*   **Основные действия:** Fold, Check, Call, Bet, Raise.
*   **Логика игры:** Раздача карт (префлоп, флоп, терн, ривер), определение победителя, обработка ставок.
*   **Интерфейсы:**
    *   Консольный (основной для MVP Фазы 1).
    *   Веб-интерфейс (добавлен, позволяет играть через браузер).
*   **Хранение состояния:** В памяти (`MemoryRepository`), но через абстрактный слой `GameRepository`.
*   **Событийная система:** Базовая система для уведомления о событиях в игре.
*   **Конфигурация:** Стартовые стеки, блайнды задаются в `poker_game/config/settings.py`.

## Архитектурный обзор

Проект построен с использованием следующих паттернов и принципов:

*   **Repository Pattern (`poker_game/storage/`):** Абстрагирует логику доступа к данным. `GameRepository` определяет интерфейс, а `MemoryRepository` является его конкретной реализацией для хранения состояния игры в памяти. Это позволяет легко заменить способ хранения (например, на SQLite) в будущем.
*   **Strategy Pattern (`poker_game/core/bot_player.py`):** Используется для реализации различных типов ботов (`RandomBot`, `TightBot`, `AggressiveBot`). Каждый бот реализует свою стратегию принятия решений (`make_decision`).
*   **Observer/Event System (`poker_game/core/events.py`):** `EventSystem` позволяет различным компонентам подписываться на события игры (`GameEvent`) и реагировать на них. Это используется для логирования и обновления интерфейса.
*   **State Machine (неявно в `GameEngine`):** Логика `GameEngine` управляет сменой фаз игры (pre-flop, flop, turn, river, showdown) и соответствующими действиями на каждом этапе.
*   **Factory (неявно в `main.py` и `GameState.from_dict`):** Применяется для создания экземпляров игроков различных типов (человек, боты) при инициализации игры и восстановлении состояния.

### Структура проекта:

```
poker_game/
├── core/                 # Основная логика игры
│   ├── game_engine.py    # GameEngine - управление игрой
│   ├── game_state.py     # GameState - сериализуемое состояние игры
│   ├── player.py         # Player (ABC), HumanPlayer
│   ├── bot_player.py     # BotPlayer (ABC), RandomBot, TightBot, AggressiveBot
│   ├── cards.py          # Card, Deck, HandEvaluator
│   ├── events.py         # EventSystem, GameEvent, Action
│   └── rules.py          # TexasHoldemRules - правила игры, определение победителя
├── storage/              # Хранение данных
│   ├── repository.py     # GameRepository (ABC)
│   └── memory_storage.py # MemoryRepository - хранение в памяти
├── interfaces/           # Взаимодействие с пользователем
│   ├── base_interface.py # GameInterface (ABC)
│   ├── console_interface.py# ConsoleInterface - консольный интерфейс
│   └── web_interface.py  # WebInterface - веб-интерфейс
├── web/                  # Файлы для веб-интерфейса
│   ├── templates/        # HTML шаблоны (game.html)
│   └── static/           # Статические файлы (CSS, JavaScript)
├── config/               # Конфигурация игры
│   └── settings.py       # Настройки (блайнды, стеки и т.д.)
├── main.py               # Точка входа для консольного приложения
└── web_server.py         # Точка входа для веб-сервера
```

## Установка и настройка

1.  **Клонировать репозиторий:**
    ```bash
    git clone <URL_репозитория>
    cd <имя_папки_проекта>
    ```
2.  **Создание виртуального окружения (рекомендуется):**
    ```bash
    python -m venv venv
    source venv/bin/activate  # Для Linux/macOS
    # venv\Scripts\activate   # Для Windows
    ```
3.  **Установка зависимостей:**
    Для работы веб-интерфейса требуются Flask и Flask-SocketIO. Установите их и другие возможные зависимости:
    ```bash
    pip install -r requirements.txt
    ```
4.  **Конфигурация (опционально):**
    Основные параметры игры, такие как размеры блайндов, стартовый стек, типы и количество ботов, можно настроить в файле:
    `poker_game/config/settings.py`. Эти настройки будут использоваться как для консольной, так и для веб-версии игры.

## Запуск игры

Игру можно запустить в нескольких режимах:

### 1. Консольный режим

   а. **Normal Mode (Обычный режим - по умолчанию):**
      Человек-игрок вводит свои действия через консоль.
      ```bash
      python -m poker_game.main
      ```
      или
      ```bash
      python -m poker_game.main --mode normal
      ```

   b. **Smoke Mode (Автоматический тестовый режим):**
      Имя человека-игрока задаётся по умолчанию ("HumanPlayer"), и все его действия выбираются автоматически (по-умолчанию: чек/колл/фолд). Этот режим используется для быстрого прогона и демонстрации игры без интерактивного ввода.
      ```bash
      python -m poker_game.main --mode smoke
      ```
   Это запустит игру в консоли. Вы увидите лог событий, состояния игры и действия игроков.

### 2. Веб-интерфейс

   Для запуска игры с веб-интерфейсом:

   ```bash
   python web_server.py
   ```
   После запуска сервера откройте в браузере адрес: `http://localhost:5000`.
   Вы увидите покерный стол, где сможете играть против ботов. Игра начнется автоматически при первом подключении к серверу.

## Известные проблемы и TODO (MVP Фаза 1)

*   **Обработка игроков с нулевым стеком:** Необходимо улучшить логику пропуска игроков с нулевым стеком при назначении дилера, постановке блайндов и в активной игре.
*   **Логика действий ботов:** Боты (`RandomBot`, `TightBot`) иногда совершают невалидные действия (например, бет некорректного размера или чек, когда нужно коллировать). Их логика принятия решений и/или валидация действий в `GameEngine` требуют доработки.
*   **Отображение блайндов:** В консольном выводе есть несоответствия между тем, кто фактически ставит блайнды, и тем, как это отображается в начале раунда при наличии выбывших игроков.
*   **Тесты `GameEngine`:** Два модульных теста для `GameEngine` (`test_post_blinds_2_players` и `test_start_game_load_existing_game_flow`) временно пропущены из-за трудностей с отладкой в текущем спринте. Их необходимо исправить.

## Планируемые расширения (после MVP Фазы 1)

*   **Фаза 2: Персистентность:**
    *   Интеграция с SQLite для сохранения состояния игр и статистики игроков.
    *   Возможность полноценного сохранения и загрузки сессий игры.
*   **Фаза 3: Telegram интерфейс (одиночная игра):**
    *   Реализация `TelegramInterface` для игры с ботами через личные сообщения в Telegram.
*   **Фаза 4: Telegram мультиплеер:**
    *   Расширение для игры нескольких человек в групповых чатах Telegram.
*   **Фаза 5: Улучшения ИИ и UX:**
    *   Более продвинутые стратегии ботов.
    *   Разговорчивый бот-дилер.
    *   Статистика игроков, турниры, рейтинги.

Этот README будет обновляться по мере развития проекта.
```
